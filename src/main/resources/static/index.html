<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <span>Количество ограничений: </span>
    <input type="number" class="numTextBox" min="2" max="10" value="3" id="constraintCount">
    <div id="constraintsContainer">

    </div>

    <div id="objectiveFunc">
        <span>F = </span>
        <input type="number" id="obj0">
        <span> + </span>
        <input type="number" id="obj1">
        <span>→</span>
        <select id="directionSelect" class="direction-select">
            <option value="MIN">min</option>
            <option value="MAX">max</option>
        </select>
    </div>

    <button onclick="sendData()">Решить задачу</button>
    <button onclick="generateRandomData()">Случайные данные</button>
</body>

<script>
    let constraintCountTextbox = document.getElementById("constraintCount");

    constraintCountTextbox.addEventListener('change', handleConstraintChange);
    window.addEventListener('load', () => handleConstraintChange({target: constraintCountTextbox}));

    function handleConstraintChange(e) {
        let constraintsContainer = document.getElementById('constraintsContainer');
        let constraints = constraintsContainer.querySelectorAll("div");

        // Проверка ввода количества ограничений
        let targetConstraintCount = parseInt(e.target.value) || 2;
        targetConstraintCount = Math.max(2, Math.min(10, targetConstraintCount));
        constraintCountTextbox.value = targetConstraintCount;

        let currentCount = constraints.length;

        if (currentCount > targetConstraintCount) {
            removeConstraint(constraints, targetConstraintCount);
        } 
        else if (currentCount < targetConstraintCount) {
            addConstraint(constraintsContainer, currentCount, targetConstraintCount);
        }
    }

    function removeConstraint(constraints, targetConstraintCount) {
        for (let i = constraints.length; i > targetConstraintCount; i--) {
            constraints[i - 1].remove();
        }
    }

    function addConstraint(constraintsContainer, currentLength, targetConstraintCount) {
        for (let i = currentLength; i < targetConstraintCount; i++) {
            let constraintDiv = document.createElement('div');
            constraintDiv.id = `c${i}`;
            for (let j = 0; j < 2; j++) {
                let variableTextbox = document.createElement('input');
                variableTextbox.setAttribute('type', 'number');
                variableTextbox.setAttribute('id', `v${i}${j}`);

                let xLabel = document.createElement('span');
                xLabel.innerHTML = `x<sub>${j + 1}</sub>`;

                if (j != 1) {
                    xLabel.innerText += " + ";
                }

                constraintDiv.appendChild(variableTextbox);
                constraintDiv.appendChild(xLabel);
            }

            let select = document.createElement('select');
            select.className = 'operator-select';
            select.id = `operatorSelect${i}`;

            const options = [
                { value: 'LEQ', symbol: '≤' },
                { value: 'GEQ', symbol: '≥' }
            ];

            options.forEach(opt => {
                let option = document.createElement('option');
                option.value = opt.value;
                option.textContent = opt.symbol;
                select.appendChild(option);
            });


            let rhsTextbox = document.createElement('input');
            rhsTextbox.setAttribute('type', 'number');
            rhsTextbox.setAttribute('id', `rhs${i}`);

            constraintDiv.appendChild(select);
            constraintDiv.appendChild(rhsTextbox);            
            constraintsContainer.appendChild(constraintDiv);
        }
    }

    function sendData() {
        const data = getData();
        console.log(data);

        fetch('http://localhost:8080/solve/graph', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
            console.log('Результат:', data);
        })
        .catch(error => {
            console.error('Ошибка:', error);
        });
    }

    function getData() {
        const objective = {
            coefficients: [
                parseFloat(document.getElementById('obj0').value) || 0,
                parseFloat(document.getElementById('obj1').value) || 0
            ],
            direction: document.getElementById('directionSelect').value
        };

        const constraints = [];
        const constraintDivs = document.querySelectorAll('#constraintsContainer > div');

        constraintDivs.forEach((div, index) => {
            const coeffs = [];
            
            for(let i = 0; i < 2; i++) {
                const input = document.getElementById(`v${index}${i}`);
                coeffs.push(parseFloat(input.value) || 0);
            }

            const constraint = {
                coefficients: coeffs,
                operator: document.querySelector(`#c${index} select`).value,
                rhs: parseFloat(document.getElementById(`rhs${index}`).value) || 0
            };
            
            constraints.push(constraint);
        });

        const data = {
            objective,
            constraints
        };

        return data;
    }
</script>
<script>
    function generateRandomData() {
        // Генерация целевой функции
        document.getElementById('obj0').value = getRandomInt(-10, 10);
        document.getElementById('obj1').value = getRandomInt(-10, 10);
        document.getElementById('directionSelect').value = Math.random() > 0.5 ? 'MAX' : 'MIN';
    
        // Генерация 3 ограничений
        for(let i = 0; i < 3; i++) {
            // Коэффициенты
            document.getElementById(`v${i}0`).value = getRandomInt(-10, 10);
            document.getElementById(`v${i}1`).value = getRandomInt(-10, 10);
            
            // Знак неравенства
            const select = document.querySelector(`#c${i} select`);
            select.value = Math.random() > 0.5 ? 'LEQ' : 'GEQ';
            
            // Правая часть (положительное число)
            document.getElementById(`rhs${i}`).value = getRandomInt(1, 20);
        }
    }
    
    function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }
</script>
</html>